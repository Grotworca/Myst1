<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="utf-8">
<title>WebAR ‚Äì Dom & Namiot (stabilny) + logo</title>

<!-- biblioteki -->
<script src="libs/aframe-v1.2.0.min.js"></script>
<script src="libs/mindar-image.prod.js"></script>
<script src="libs/mindar-image-aframe.prod.js"></script>

<style>
 body{margin:0;overflow:hidden;font-family:system-ui}
 #msg{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;
      background:#000;color:#fff;font-size:18px;z-index:9;text-align:center}
 #hud-logo{
   position:fixed;top:8px;left:8px;width:64px;height:auto;
   background:#ffffffb0;border:2px solid #fff;border-radius:8px;
   z-index:10000;pointer-events:none}
 a-scene{width:100vw;height:100vh}
</style>
</head>
<body>

<img id="hud-logo" src="assets/WIZJA.png" alt="logo">
<div id="msg">üîç ≈Åadowanie‚Ä¶</div>

<!--  filterBeta = 0.5 wyg≈Çadza drobne drgania  -->
<a-scene id="scene" embedded
         mindar-image="imageTargetSrc:targets.mind;autoStart:true;filterBeta:0.5;"
         vr-mode-ui="enabled:false"
         device-orientation-permission-ui="enabled:true">

  <a-assets>
    <img id="tex-dom"    src="assets/S1DOM_X.png">
    <img id="tex-namiot" src="assets/S1NAMIOT_X.png">
  </a-assets>

  <a-camera look-controls="enabled:false"></a-camera>

  <!-- indeksy zgodne z Visualize: 0-Namiot, 1-Dom -->
  <a-entity id="anchor-namiot" mindar-image-target="targetIndex:0"></a-entity>
  <a-entity id="anchor-dom"    mindar-image-target="targetIndex:1"></a-entity>
</a-scene>

<script>
(async()=>{
/* --- minimalne sprawdzenie ≈õrodowiska --- */
const M=document.getElementById('msg');
try{
  if(typeof AFRAME!=='object')            throw'‚ùå A-Frame nieza≈Çadowany';
  if(typeof MINDAR==='undefined')         throw'‚ùå MindAR nieza≈Çadowany';
  const r=await fetch('targets.mind');
  if(!r.ok||r.headers.get('content-length')==='0') throw'‚ùå targets.mind brak / 0 B';
  await navigator.mediaDevices.getUserMedia({video:true})
        .then(s=>s.getTracks().forEach(t=>t.stop()));
  M.style.display='none';
}catch(e){M.textContent=e;return}
/* ---------------------------------------- */

function spawn(anchor, texId, opts={}){
  const img=document.querySelector(texId); if(!img) return;
  const h = img.naturalHeight / img.naturalWidth;
  const p = document.createElement('a-plane');
  p.setAttribute('src',texId);
  p.setAttribute('width', opts.width  ?? '1');
  p.setAttribute('height',opts.height ?? h );
  p.setAttribute('position',`0 0 ${opts.z ?? 0.001}`);
  p.setAttribute('material','shader:flat;transparent:true');
  anchor.innerHTML=''; anchor.appendChild(p);
}

/* --- Namiot (index 0) ‚Äì plane 0.95 √ó 0.95, odsuniƒôty 0.005 --- */
const aNam=document.getElementById('anchor-namiot');
aNam.addEventListener('targetFound',()=>{
  spawn(aNam,'#tex-namiot',{width:'0.95',height:0.95*(550/580),z:0.005});
});
aNam.addEventListener('targetLost', ()=>aNam.innerHTML='');

/* --- Dom (index 1) ‚Äì pe≈Çne 1√óAR, minimalne odsuniƒôcie 0.001 --- */
const aDom=document.getElementById('anchor-dom');
aDom.addEventListener('targetFound',()=>{
  spawn(aDom,'#tex-dom',{z:0.001});
});
aDom.addEventListener('targetLost', ()=>aDom.innerHTML='');
})();
</script>
</body>
</html>
