<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>WebAR ‚Äì Czarodziej</title>

  <!-- Biblioteki MindAR i A-Frame -->
  <script src="https://cdn.jsdelivr.net/gh/MindAR-js/aframe/dist/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/MindAR-js/aframe/dist/mindar-image.prod.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/MindAR-js/aframe/dist/mindar-image-aframe.prod.js"></script>

  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div id="loading">≈Åadowanie aplikacji AR...</div>

  <!-- Sprawdzenie obs≈Çugi kamery i pliku targets -->
  <script>
    async function sprawdzWarunki() {
      // Kamera
      if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        alert("‚ùå Twoja przeglƒÖdarka nie obs≈Çuguje kamery.");
        return false;
      }

      // Pr√≥ba dostƒôpu do kamery
      try {
        await navigator.mediaDevices.getUserMedia({ video: true });
      } catch (err) {
        alert("‚ùå Brak dostƒôpu do kamery: " + err.name);
        return false;
      }

      // Plik targets.mind
      try {
        const res = await fetch("targets.mind");
        if (!res.ok) {
          alert("‚ùå Nie mo≈ºna za≈Çadowaƒá pliku targets.mind.");
          return false;
        }
      } catch (err) {
        alert("‚ùå B≈ÇƒÖd sieci przy ≈Çadowaniu targets.mind: " + err.message);
        return false;
      }

      return true;
    }

    // G≈Ç√≥wne uruchomienie
    sprawdzWarunki().then(ok => {
      if (ok) {
        document.getElementById("loading").style.display = "none";
        document.getElementById("scene-container").style.display = "block";
      }
    });
  </script>

  <!-- Ukryta scena (pokazuje siƒô po sprawdzeniu) -->
  <div id="scene-container" style="display:none;">
    <a-scene
      mindar-image="imageTargetSrc: targets.mind; autoStart: true;"
      embedded
      color-space="sRGB"
      renderer="colorManagement: true, physicallyCorrectLights"
      vr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: true">

      <a-assets>
        <img id="czarodziej" src="assets/czarodziej.png" />
      </a-assets>

      <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

      <a-entity mindar-image-target="targetIndex: 0" visible="false" id="target">
        <a-image src="#czarodziej" position="0 0 0" height="1" width="1"></a-image>
      </a-entity>
    </a-scene>
  </div>

  <!-- Logowanie detekcji -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const scene = document.querySelector("a-scene");
      const target = document.querySelector("#target");

      if (!scene || !target) return;

      scene.addEventListener("targetFound", () => {
        console.log("üéØ Obrazek rozpoznany!");
        target.setAttribute("visible", "true");
      });

      scene.addEventListener("targetLost", () => {
        console.log("üëã Obrazek zgubiony.");
        target.setAttribute("visible", "false");
      });
    });
  </script>
</body>
</html>
